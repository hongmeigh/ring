<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>select</title>
    <script src="jquery-1.11.2.min.js"></script>
    <style>
        /* webkit, opera, IE9 */
        div::selection { background:orange;color：#fff； }
        /* mozilla firefox */
        div::-moz-selection { background:orange; }
        .btn{
            position: fixed;
            display: none;
            top: 0;
            left: 0;
        }
    </style>
}
</head>
<body>
    <div id="zuowen" style="width:800px; height:600px; font-size:16px;">
        老师给我们说，已经在四个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，那个团队的人员，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完后，再选出前三名的团队，给予奖励。参加过的人，都会有奖励。但是不参加的人，他们班规定每人扣一分。希望你们班，能好好表现，我下次就看你们班了.老师给我们说，已经在四<br>个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的<>流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，那个团队的人员，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完后，再选出前三名的团队，给予奖励。参加过的人，都会有奖励。但是不参加的人，他们班规定每人扣一分。希望你们班，能好好表现，我下次就看你们班了.老师给我们说，已经在四个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，那个团队的人员，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完后，再选出前三名的团<br>队，给予奖励。参加过的人，都会有奖励。但是不参加的人，他们班规定每人扣一分。希望你们班，能好好表现，我下次就看你们班了.老师给我们说，已经在四个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，那个团队的人员，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完后，再选出前三名的团队，给予奖励。参加过的人，都会有奖励。但是不参加的人，<br>他们班规定每人扣一分。希望你们班，能好好表现，我下次就看你们班了.
    </div>
    <div id="zuowen22" style="width:800px; height:600px; font-size:16px;">
        老师给我们说，已经在四个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话,
        老师给我们说，已经在四个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，那个团队的人员，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完<br>后，再选出前三名的团队，给予奖励。参加过的人，都会有奖励。但是不参加的人，他们班规定每人扣一分。希望你们班，能好好表现，我下次就看你们班了.老师给我们说，已经在四个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，那个团队的人员，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完后，再选出前三名的团队，给予奖励。参加过的人，都会有奖励。但是不参加的人，他们班规定每人扣一分。希望你们班，能好好表现，我下次就看你们班了.老师给我们说，已经在四个班<br>举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，那个团队的人员，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完后，再选出前三名的团队，给予奖励。参加过的人，都会有奖励。但是不参加的人，他们班规定每人扣一分。希望你们班，能好好表现，我下次就看<br>你们班了.老师给我们说，已经在四个班举办过了，有一个班的表演非常成功，人家的纪律啊，流程啊，非常好。他们有主持人和评委，看着还真像那么一回事。他们的的流程是先主持人上台讲话，然后由主持人再来报名字，团队名字，<br>，就从后门出去，从前门入场，唱完之后，评委就开始打分。最后，全部唱完后，再选出前三名的团队，给予奖励。参加过的人，都会有奖励。但是不参加的人，他们班规定每人扣一分。希望你们班，能好好表现，我下次就看你们班了.
    </div>
    <div class="btn">
        <button id="btnn">标记</button>
    </div>
    <script>
    //兼容性有问题
    //document.onselectionstart=function(e){
        //var word = document.selection.createRange().text;
        //window.getSelection().getRangeAt(0).endContainer.parentElement
        //用splice
        //console.log(window.getSelection().getRangeAt(0).endContainer.parentElement.childNodes[0])
        // var start=window.getSelection().getRangeAt(0).startOffset;
        // var end=window.getSelection().getRangeAt(0).endOffset;
        //var parent=window.getSelection().getRangeAt(0).endContainer.parentElement;
        // console.log(start+" "+end);
        // var arr=parent.innerText.split("").splice(start,0,"<span style='background:orange'>");
        // console.log(arr)
        // arr=arr.splice(end+1,0,"</span>");
        // console.log("输出"+arr)
        //parent.innerHTML=arr.join("");
        //console.log(window.getSelection().getRangeAt(0))
        // alert("ok")
        // if(window.getSelection().getRangeAt(0).toString().length>0&&window.getSelection().getRangeAt(0).endContainer.parentElement.id=="zuowen22"){
        //     alert("ok")
        //     window.selecable=true;
        // }
    //}
    function replaceToA() {
        if(window.getSelection){
            var z = window.getSelection().getRangeAt(0);
            //var t = z.toString();
			var t=z.cloneContents()
            var temp = document.createElement("span");
            temp.style.backgroundColor="red";
			temp.setAttribute("class","select");
			temp.appendChild(t)
            //temp.innerHTML = t;
            z.deleteContents();
            z.insertNode(temp);
        }else{
            var z = document.selection.createRange();
            var t = z.text;
            var v = z.htmlText;
            z.select();
            z.pasteHTML("<span class='select' style='background-color:red'>"+v+"</span>");
        }
        // if (document.selection) {
        //     var z = document.selection.createRange();
        //     var t = z.text;
        //     var v = z.htmlText;
        //     z.select();
        //     z.pasteHTML("<span style='background-color:red'>"+v+"</span>");
        // } else {
        //     var z = window.getSelection().getRangeAt(0);
        //     var t = z.toString();
        //     var temp = document.createElement("span");
        //     temp.style.backgroundColor="red";
        //     temp.innerHTML = t;
        //     z.deleteContents();
        //     z.insertNode(temp);
        // }
    }
	document.onmousedown=function(e){
		if($(window.event.srcElement).attr("id")!="btnn"){
			$(".btn").hide();			
			//alert("ok")
			}
		}
    document.onmouseup = function(e){
		console.log($(window.event.srcElement).attr("class"))
		if($(window.event.srcElement).attr("class")=="select"){
			console.log("111");
			return;
			}
        if(window.getSelection){
            if(window.getSelection().getRangeAt(0).toString().length>0&&($(window.getSelection().getRangeAt(0).endContainer.parentNode).attr("id")=="zuowen22"||$(window.getSelection().getRangeAt(0).startContainer.parentNode).attr("id")=="zuowen22")){
                $(".btn").css({"top":e.clientY-20,"left":e.clientX-10})
                $(".btn").show();
            }
        }else{
            if($(window.event.srcElement).attr("id")=="zuowen22"&&document.selection.createRange().text.length>0){
                $(".btn").css({"top":window.event.clientY-20,"left":window.event.clientX-10})
                $(".btn").show();
            }
        }
    }
    $(".btn button").click(function(){
        replaceToA();
        $(".btn").hide();
    })
    </script>
</body>
</html>